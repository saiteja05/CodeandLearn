from pymongo.mongo_client import MongoClient
from pymongo.server_api import ServerApi
from sentence_transformers import SentenceTransformer
import sys

# total arguments
# n = len(sys.argv)
# print("len",n)

query = "a romantic comedy"


model = SentenceTransformer('all-MiniLM-L6-v2')
uri="mongodb+srv://locust:locust@cluster0.tcgzn.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0"


client = MongoClient(uri, server_api=ServerApi('1'))

try:
    query_embedding = model.encode(query).tolist()
    # query_embedding=
    db = client.sample_mflix
    dataset = db.movies_subset
    agg = [
        {
            "$vectorSearch": {
                "index": "vector_index",
                "path": "fullplot_embeddings",
                "queryVector": query_embedding,
                "numCandidates": 20,
                "limit": 5
            }
        }
    ]
    db = client.sample_mflix
    dataset = db.movies_subset
    # running the vector search
    outDocs = dataset.aggregate(agg)
    for i in outDocs:
        print(i["title"])

   #  db2=client.intellect_test
   #  data=db2.attribute
   #  embeds=[-0.00422243,0.0009951469,-0.007941566,-0.009536416,-0.02373973,0.020170925,-0.011497296,0.01105283,-0.014118341,-0.018693728,-0.017164242,0.0051146303,0.0057355757,0.0063630575,-0.012791478,0.006882691,0.021177512,-0.0047878167,0.002676602,-0.015020345,-0.028811872,0.026981717,-0.0075493907,-0.00772587,0.00086932373,-0.003601484,0.0013350329,-0.008778209,-0.013399351,0.00233835,-0.00088484737,-0.009229211,-0.02972695,-0.01483733,-0.0022778898,0.0010539733,-0.009673677,0.0106868,0.027217023,-0.0007218492,0.0050231228,0.006180042,-0.015137998,-0.0051669204,-0.015687045,0.00023346735,-0.004915274,0.0036080203,-0.023125319,0.00034928185,0.014510517,0.02503391,-0.024707096,-0.020131707,0.011020149,-0.023073029,-0.018811382,0.008170336,0.018889816,-0.015909279,0.010634509,-0.021269018,-0.040969335,0.0041472623,-0.02205337,-0.006104875,-0.019281993,-0.0058728377,0.0039544427,0.00844486,0.030642029,0.017059661,-0.011118193,-0.019556517,0.0027583055,-0.012098634,-0.00021978204,-0.014196776,0.012869913,0.010072391,0.0059022508,-0.014902693,-0.019033615,0.017896304,0.028759582,0.0052584284,-0.015490957,0.032890506,-0.0048074257,-0.0018677388,0.032106154,0.020576173,-0.021046786,-0.0014412473,-0.03385787,-0.008954688,-0.005715967,0.044734225,0.014000688,0.0024037128,0.01154305,-0.022131806,-0.03004069,-0.0038237171,-0.01473275,-0.017778652,-0.025151562,-0.020785335,0.0069872714,0.041649103,-0.0031439452,0.0030736804,0.0077127973,-0.008778209,0.012039807,-0.029177904,0.011431934,-0.013026783,-0.01259539,-0.019556517,0.014183703,-0.0059708813,-0.002188016,0.0011413959,0.020798407,-0.0008464468,-0.027190879,-0.012477737,-0.01035345,0.010033173,0.031766266,0.018837526,0.026563397,0.004594997,-0.013379742,0.0036864555,-0.0018808113,0.01932121,-0.021804992,-0.01226204,0.0015621682,0.0187068,-0.012863377,0.0048793247,0.025569884,-0.0011029954,-0.014981128,0.004016537,-0.009098486,-0.028445842,0.006686603,-0.034145467,0.002214161,-0.021804992,0.019177413,0.0153994495,0.005330327,0.025831334,-0.02550452,0.005402226,-0.0037420138,0.021164438,0.008379497,0.0022190632,0.03482524,0.020000983,0.0071572145,0.02028858,-0.019700315,-0.00012878492,-0.012608463,0.0060591213,-0.009105022,0.0065591456,0.02194879,0.02993611,-0.011497296,-0.010850206,-0.0022223315,-0.026981717,-0.028707292,0.0038956162,0.012281649,0.014327501,-0.00064831617,-0.0027321603,0.026707195,0.005075413,0.024014251,-0.0135954395,0.013791528,0.0047616716,0.000900371,-0.02065461,-0.6705689,-0.017347258,0.0020180729,-0.022994593,0.018353842,0.028916454,0.028759582,0.02298152,-0.007542854,-0.009804403,-0.004405445,0.022785433,0.0020850697,0.013118291,-0.001581777,-0.015778553,-0.012255504,-0.004545975,0.013817673,-0.00301322,-0.009366473,0.026197365,-0.011425398,0.0011054465,0.03147867,-0.00803961,0.0041211173,-0.026759485,-0.023229899,0.009333792,-0.0099743465,0.0054087625,0.014340574,0.018576076,0.04295636,-0.019817967,-0.02245862,0.032289166,0.0055394876,0.053858854,-0.0117391385,0.0054577845,0.013111755,-0.024720168,-0.0008734089,0.016353745,0.030354433,-0.00662124,-0.006614704,-0.020092491,0.010562611,-0.019504227,-0.042485747,0.018040102,0.0019886598,-0.011954836,0.027007863,0.008320671,0.036027912,0.018746018,0.021621978,-0.006095071,-0.0062159915,-0.024027323,0.010876351,-0.00053148036,-0.027478473,0.011092048,-0.0014052978,-0.0073140846,0.0009665507,0.037831925,-0.017373402,0.023007667,0.01694201,0.013222871,0.00027186793,0.0033629104,-0.00017178131,-0.0015719726,-0.00034192856,0.01483733,-0.014928838,0.010837134,0.02163505,0.00394137,-0.006948054,-0.0081049735,0.028916454,-0.0093534,0.0152948685,-0.00844486,-0.0016618463,0.0040982408,-0.021321308,0.030772753,-0.0027043812,0.022837723,0.010320769,-0.02039316,-0.00854944,0.008784745,-0.005421835,0.00486952,0.01813161,0.026955573,-0.016406035,0.0014306258,0.031452525,-0.03709986,0.014288284,0.0075363177,-0.015856989,-0.017033517,-0.019831039,-0.033413406,0.039479062,-0.00040136775,-0.016040003,-0.018563004,0.02787065,-0.000023323755,0.0066571897,0.004108045,0.011882937,0.01807932,0.007895812,-0.018902889,-0.0106868,-0.0024886844,0.0050394633,-0.010412276,0.031504817,-0.004644019,0.045047965,0.0037550863,0.0054610525,-0.0041015088,0.0077454783,-0.029334774,-0.014981128,-0.01468046,-0.0065558776,-0.021752702,-0.010706408,-0.03764891,-0.014562807,-0.003135775,-0.040734027,-0.025975132,-0.024759386,-0.010974395,-0.039688226,-0.0018677388,-0.010320769,-0.0153079415,0.0025393404,-0.014209848,-0.023386769,-0.013327452,-0.0047289906,0.017726362,-0.016471397,-0.016118439,0.002920078,0.0013235945,0.011340426,0.02298152,-0.0018138146,-0.01834077,0.014340574,0.018889816,0.010797916,0.025975132,-0.015020345,0.020785335,-0.0073598386,0.0025671197,0.0009559293,0.009078877,-0.0038106446,-0.010765235,-0.028602712,0.0044806125,0.024497936,-0.0052192104,0.014628169,-0.008405642,-0.00243476,-0.01658905,0.02745233,-0.0011413959,-0.023256045,0.0066277767,-0.0038269854,0.014118341,-0.003947906,0.00090200506,-0.00025756983,0.008516759,0.0045851925,0.011562659,0.010817525,-0.018484568,0.010190043,-0.030459013,0.004304133,-0.03367486,0.027138587,0.007150678,-0.012771869,-0.020471593,-0.017739434,-0.0036635788,0.009595242,0.033805583,0.0099089835,0.007490564,0.010386131,-0.0013832379,-0.006895764,-0.007823913,0.004889129,0.009000442,-0.041544523,-0.009163849,0.014471299,0.010915569,0.0031259705,-0.009366473,-0.017987812,-0.0112816,0.0072291135,0.0042583793,0.002576924,0.01813161,0.020929134,-0.027086297,0.018563004,0.010752162,0.0016226288,-0.004647287,0.017491056,0.00054455287,0.0058597648,0.002748501,0.034459207,0.004542707,-0.006948054,0.019386573,0.0054871975,-0.005905519,0.007804305,0.0016479568,0.022040298,-0.014902693,0.0058564967,0.01133389,0.0032207465,0.015739335,0.0081115095,-0.007928494,0.024942402,0.004353155,0.020249361,0.0006593461,-0.012092098,-0.013333988,0.022040298,-0.008575585,0.000255323,0.0038694711,0.019608807,-0.0038335216,-0.008307598,-0.008418715,0.010536465,-0.012085561,-0.007268331,-0.0014289918,-0.007248722,-0.028785728,0.016066149,0.026602615,-0.0053074504,-0.03014527,-0.014693532,0.0029037374,-0.0069415173,0.014066051,0.012575781,0.021164438,-0.019857185,0.0068238648,-0.040263414,-0.021608904,0.037910357,-0.02740004,-0.006719284,0.0033825191,0.0034315411,-0.011471151,0.011882937,-0.026301946,0.054538626,-0.029596224,-0.026419599,0.0065526096,0.0051603843,-0.017399548,-0.031923138,-0.015242578,-0.032289166,0.00165531,0.0028089616,-0.007804305,-0.01834077,0.0058597648,0.044838805,-0.0046865046,0.014915765,-0.009072341,-0.009660605,-0.0012909131,0.117862,0.0010335475,0.007399056,-0.00054373586,-0.0018775432,0.0029462231,-0.019883329,-0.004395641,-0.014379791,0.015778553,-0.000899554,-0.013079074,-0.009477589,0.011026685,0.020406231,0.0062323324,-0.01942579,-0.017059661,0.030642029,0.0012999005,0.010856742,-0.02792294,-0.009405691,0.019752605,0.012706506,0.016811283,0.007863131,-0.0041211173,0.00574538,-0.010529929,0.034067035,-0.0052420874,-0.005715967,-0.01658905,0.014641242,-0.008928543,-0.0069611263,-0.0024658074,0.01550403,0.003647238,0.030668173,-0.0072879395,0.0064349566,-0.007104924,0.019386573,-0.0013546417,0.009922056,0.02081148,0.021935718,-0.0075559267,0.03090348,-0.017399548,0.01024887,-0.014981128,0.0010025002,0.011856792,-0.009471053,0.0002730935,-0.013451641,-0.016575977,-0.012876449,-0.033256534,0.0134908585,0.0049512237,-0.014654315,-0.038668565,-0.0313218,-0.008013465,-0.014549734,-0.037492037,0.0069349813,0.02081148,-0.008686701,0.009026587,0.014562807,0.013778455,0.010830597,-0.0043923724,-0.0069023,0.0483161,-0.01592235,-0.003699528,-0.03163554,-0.020733045,-0.020563101,0.025164634,0.018210044,-0.021282092,-0.014968055,0.0046048015,0.020563101,-0.006300963,0.006784647,-0.03291665,-0.017595636,-0.010693336,0.012072489,0.028602712,-0.021726558,0.014876548,0.0014771967,-0.017268822,0.024249557,-0.0020131709,0.027007863,0.0011242382,-0.008673629,0.004699577,-0.0175172,-0.0013048026,0.0040001967,-0.020367013,0.009484126,-0.006248673,-0.010268479,0.008477541,0.019608807,0.017072733,0.0029462231,0.012235895,-0.011608413,-0.026511107,0.022197168,0.020929134,-0.008941616,-0.012798014,0.009804403,-0.011863328,-0.0062650135,0.0034870994,0.006046049,-0.017909376,0.008340279,-0.014902693,-0.039845094,-0.0031962355,-0.00072593434,0.0072552585,0.017294968,-0.011366571,-0.037021425,0.0042910604,-0.021726558,0.013209799,-0.020458521,-0.01813161,0.0032403553,-0.025426086,-0.012732652,0.023713583,-0.010059318,0.0035557302,-0.0013726164,0.0038400579,-0.015490957,-0.020419303,-0.014471299,-0.019177413,0.020824552,0.02983153,0.018811382,0.008386033,0.030485157,0.012876449,-0.010412276,-0.026210438,0.001579326,0.004693041,-0.016092293,0.021216728,0.029125614,0.02184421,0.014288284,-0.00018219849,-0.0024821481,0.017164242,0.0075297817,-0.014079123,0.027687635,-0.02734775,-0.007993856,-0.021138294,-0.02664183,-0.022706999,-0.025099272,-0.009471053,-0.00369626,-0.00569309,-0.006719284,-0.0045067575,0.01797474,-0.022798505,0.025713682,-0.01133389,-0.013196726,0.004673432,-0.0008701408,-0.0006548524,0.016811283,0.023203755,-0.0059447363,0.010484175,-0.014353646,0.0069676624,0.007098388,0.0262758,-0.00369626,0.016249165,0.017504128,-0.017138097,-0.02781836,-0.015843915,-0.020301651,-0.018732946,0.013425496,0.0062846225,0.008863181,0.018157754,-0.03260291,0.0008203017,-0.020733045,-0.004895665,0.0049512237,0.008353352,0.013327452,0.0067454292,0.016445253,-0.01849764,0.021778848,-0.003210942,-0.013412423,0.0033008158,0.037256733,0.00037522268,-0.027295459,-0.00486952,0.006856546,-0.0038106446,0.0077127973,0.020981424,0.011614949,-0.005748648,-0.020615391,0.01963495,-0.014954983,0.005006782,-0.010314232,-0.01694201,-0.012778405,-0.0015106951,-0.0077127973,-0.0058728377,-0.019844113,0.011967909,0.008869717,-0.012680361,0.002701113,-0.0023661293,0.0135954395,0.010608364,0.00048776905,0.0080722915,-0.0073075485,0.0015695215,0.013235944,0.011392716,-0.016732847,0.0038498624,0.010275015,0.019804895,-0.013438568,-0.011471151,0.029099468,0.00651666,0.005712699,-0.013843818,0.0048760567,-0.013935325,-0.004421786,-0.014615097,0.004500221,-0.005523147,0.013830745,0.007438274,-0.0017141365,-0.015242578,0.00037297583,0.0029968792,0.011699921,0.006251941,-0.0135823665,-0.018772164,-0.0099482015,0.0117783565,0.008327207,0.00040300182,0.025125418,0.02303381,-0.0047518676,0.0046309466,0.017504128,0.02622351,-0.007320621,0.002823668,0.005055804,-0.01159534,0.022471692,-0.018053174,-0.020458521,-0.021700412,0.0065133916,-0.011059367,-0.0018889817,0.0014878182,0.0046080695,-0.013026783,-0.014954983,-0.009274965,-0.03508669,0.0098697655,-0.00422243,-0.007196432,0.012588854,-0.012013662,0.025870552,0.026903283,-0.0011087146,0.011150874,-0.018000884,-0.0029968792,0.0007006063,0.030720463,0.009850157,-0.007523245,-0.007196432,-0.0029315166,-0.005248624,0.035661884,-0.00963446,-0.0054087625,-0.004719186,0.020693827,0.015085708,0.0040753637,-0.014811185,-0.0076539707,-0.027217023,0.01210517,-0.00777816,-0.027217023,-0.01545174,0.011523441,0.021177512,-0.037465893,-0.011647631,0.01683743,-0.042538036,0.010621437,-0.013281698,0.0025556812,0.02951779,0.013229408,0.008033074,-0.009627924,0.0138046,-0.011451543,-0.016471397,-0.010366523,0.011301208,-0.016680557,0.023269117,0.014981128,-0.02622351,-0.017334186,0.024131903,0.025765972,0.019138195,-0.021608904,-0.021059858,0.018798308,0.00685001,0.010804452,0.008863181,0.01762178,0.015190288,-0.025805188,-0.013072537,0.016824355,-0.003186431,-0.03142638,-0.0021945522,-0.0046146056,0.010543002,-0.014157558,-0.015477885,-0.0098697655,0.020066345,-0.0070918514,0.026824847,-0.012124779,-0.025478376,-0.01210517,-0.0081180455,-0.014549734,0.010588756,0.003601484,-0.0631665,-0.028890308,-0.00080600363,-0.034694515,-0.0135562215,-0.028262826,-0.01730804,-0.008261844,0.0019396378,-0.024171121,-0.013124827,-0.008301062,0.007366375,0.023046883,-0.033047374,0.0017321112,-0.024667878,-0.009477589,-0.0034152004,-0.0029576616,0.02303381,-0.007098388,-0.0036831875,0.019046687,-0.037596617,-0.024027323,0.008255308,0.0035067082,0.0076474342,-0.00012020607,0.23844309,0.0073533026,-0.028968744,0.017935522,0.02941321,0.0074317376,0.02983153,0.008856644,-0.01550403,0.018275408,-0.03529585,-0.0036145567,-0.003552462,0.009438372,-0.0055394876,-0.012667289,-0.019242775,-0.053806566,-0.017896304,-0.029151758,0.001872641,-0.0153079415,-0.014052978,-0.011647631,0.024249557,-0.005666945,-0.0193735,0.0018448619,0.025164634,0.017321112,-0.0039348337,0.037622765,0.022197168,0.015137998,-0.004402177,0.006372862,-0.0014175533,0.0014224555,0.022027226,0.029021034,-0.024066541,-0.004889129,-0.037021425,0.0017827674,-0.009510271,0.011614949,-0.013262089,-0.013366669,0.010817525,0.015242578,-0.029648514,-0.01953037,-0.00097227,0.015830843,-0.011902546,-0.003572071,0.02545223,0.018942107,-0.006144093,-0.011379644,-0.012340476,0.03296894,-0.028341262,0.0015352061,0.00569309,0.009771721,-0.025765972,0.027190879,0.005124435,-0.014092196,0.012386229,-0.006598363,-0.0010025002,-0.004277988,-0.019674169,-0.022628563,0.032210734,0.0100004915,0.015634755,0.03239375,-0.015229506,0.0033694466,-0.01926892,0.026040494,0.0135300765,-0.036237076,0.005820547,-0.015700117,0.006294427,0.0014804648,0.0154255945,0.00011060592,-0.023922743,-0.020000983,0.011020149,0.016458325,0.023491351,0.02967466,0.0014804648,0.021360526,-0.009346864,-0.0046048015,-0.013249016,-0.0038465941,-0.015098781,0.005349936,0.015582465,0.0059643453,0.00008042675,0.0018873477,-0.023752801,-0.013922253,-0.010824061,0.009274965,-0.000056988094,0.018484568,0.0074513466,-0.009189994,0.020380085,-0.0047028456,-0.0025328042,0.003210942,-0.007516709,0.026079712,0.0135562215,-0.020889916,-0.023530567,-0.008274917,-0.012778405,-0.060761154,0.02147818,0.0066833347,0.022576272,0.009065805,-0.017125024,0.018837526,0.0070330254,-0.0081245825,-0.008791282,-0.0037093326,-0.0015384742,-0.011111657,0.0021782115,0.0048531797,0.005229015,-0.019543443,-0.0044904165,-0.020118635,-0.010471103,-0.0030671442,-0.0060395123,-0.028864162,0.0030834847,-0.017987812,0.025321506,-0.014118341,0.0024200536,-0.020223215,0.007144142,0.0025148294,-0.04423747,0.010673727,0.016406035,0.008170336,-0.0065526096,0.013275162,-0.16795596,0.020798407,0.014850402,0.0047845487,0.0117129935,0.015177216,0.01205288,0.030171417,-0.030694319,0.021988008,0.008307598,0.0029838067,-0.031713977,0.003085119,0.010281551,-0.012758797,-0.015530175,-0.011275063,0.014131413,-0.013830745,-0.004774744,-0.010706408,0.018576076,-0.028838018,-0.0060133673,-0.0019510762,-0.018876744,0.01478504,-0.008392569,-0.008980833,-0.0052813054,0.0015883133,0.028001375,0.0064872466,0.00052453554,0.0098436205,0.001874275,0.0024461986,-0.0045361705,0.011699921,0.022131806,0.010974395,0.005928396,-0.01905976,-0.030459013,-0.01045803,0.01643218,-0.0011136167,0.02648496,0.002965832,-0.014157558,-0.0093534,0.029125614,0.004451199,0.0256091,-0.009824012,-0.016523687,0.023465205,0.016314527,0.010484175,-0.017987812,-0.009405691,0.006565682,-0.020105563,0.0066571897,-0.020994496,0.009614851,-0.006098339,-0.010758698,0.025818262,-0.0020687291,-0.034459207,0.0076539707,-0.002261549,0.020027127,0.008353352,-0.003699528,0.014353646,-0.014209848,0.002237038,-0.002898835,0.035975624,-0.024563298,0.012817623,0.0032158443,-0.010837134,-0.004552511,-0.015647827,0.013477786,-0.0022076247,0.028341262,-0.0134647135,0.005957809,-0.020367013,0.03657696,0.020589247,-0.0022795238,0.018471496,-0.0017321112,-0.0057747937,-0.020144781,-0.007967711,-0.031138785,-0.0005878557,0.04713957,0.011503833,0.015543248,0.0032763048,0.03137409,-0.009876302,-0.0028922989,-0.017778652,-0.00036889067,0.006124484,-0.004039414,0.012288186,0.018327698,-0.034589935,0.005222479,0.0025001229,0.025269216,-0.000044145345,-0.0064839786,0.01555632,-0.0047387946,-0.006693139,-0.06776804,-0.02503391,0.022354038,0.025269216,-0.016275309,0.022955377,-0.0024821481,-0.012275113,-0.01329477,-0.0056832856,-0.0041603353,-0.016510615,0.008379497,-0.006121216,0.0414138,-0.0076670432,0.00038849947,0.0047845487,-0.00006240094,0.0048858607,-0.022367112,-0.013307843,0.004281256,-0.011634558,-0.029047178,-0.00064545654,-0.011510369,0.015961569,0.016353745,0.02215795,0.012412375,0.0013342159,-0.0049512237,-0.0049512237,-0.00734023,-0.0005376081,0.031347945,-0.01243852,0.0392699,-0.007523245,-0.0022778898,0.0009910618,0.0039315657,-0.03853784,0.0020262434,-0.022693925,-0.008431787,0.025203852,0.011301208,-0.019399647,-0.008784745,0.0021749435,0.008006929,-0.011641094,0.017451838,0.009242284,0.008542904,0.006882691,-0.011431934,-0.004722454,-0.0004930798,0.012641144,-0.016223019,0.012203214,0.026184293,0.0076539707,-0.023020739,-0.012392766,0.021831138,-0.0052094064,-0.009118095,-0.00574538,-0.020510811,0.012098634,-0.023360625,-0.014575879,-0.010471103,-0.007320621,-0.0059708813,-0.02519078,-0.019569589,-0.016144583,0.000850532,0.00017882822,0.018458422,0.046538234,0.00821609,-0.0018285211,0.017451838,-0.031818558,0.009824012,0.024850894,0.009510271,-0.0276092,-0.030249853,0.00034131578,-0.021988008,-0.008745528,0.0019902939,0.008078828,-0.022327894,0.00844486,-0.09391311,0.0154255945,0.0003766525,-0.010444958,-0.016510615,0.0043596914,0.017660998,-0.007072243,0.0134647135,-0.0026929427,-0.023177609,0.0026439207,0.0013570928,0.012510419,-0.0013023516,0.011033222,0.029387064,0.008098437,0.0062650135,0.018667584,-0.019046687,0.0006009282,0.0044806125,-0.013249016,-0.012098634,0.021059858,-0.02153047,0.019870257,-0.028681148,-0.0029756364,0.006490515,-0.014824257,-0.020223215,0.039086886,0.0010793013,-0.017033517,0.011647631,0.018314624,0.0081572635,-0.021059858,-0.018746018,-0.0043629594,0.0046309466,0.008033074,-0.00973904,-0.008752064,0.005722503,0.01854993,0.0339886,-0.0015245847,-0.02776607,0.017634854,-0.00060460484,-0.008830499,-0.015321014,0.0014061148,0.003359642,0.014196776,0.0047845487,-0.019451937,0.028550422,0.008608266,0.011876401,0.011268527,0.023412915,-0.02287694,0.018746018,0.009006978,0.0015539979,0.005617923,-0.0017696947,-0.01040574,0.010562611,0.01555632,-0.0025442427,-0.021386672,0.00651666,-0.023491351,-0.025007764,0.019961765,0.0049937093,-0.0014837331,-0.015752409,0.0081115095,0.024615588,-0.00052739517,-0.0230861,0.001338301,-0.0021275554,0.024707096,-0.0021929182,-0.007980784,-0.00014614688,-0.0040230732,0.009556025,0.0071572145,-0.004425054,0.013307843,-0.018196972,0.024772458,-0.0112816,0.0026667977,-0.0031913333,-0.007242186,-0.026419599,0.010124681,-0.024680952,-0.0135562215,-0.0059708813,0.008693238,0.016575977,0.021007568,-0.0032632323,0.008144191,-0.020053273,0.0134908585,0.010190043,0.012177069,-0.00979133,0.014562807,0.0002567528,-0.00004549856,0.010601828,-0.015948497,0.028471988,0.029177904,-0.012510419,-0.019125123,-0.0011471151,-0.009314183,-0.0028530813,0.029021034,0.01249081,-0.002526268,-0.0017860355,0.0029102736,0.0004350704,0.038747,-0.03333497,0.041753683,0.0003717503,-0.021308236,-0.016366817,-0.026315019,0.023256045,-0.0006854912,0.016353745,-0.015543248,-0.050303124,0.00772587,0.015098781,0.016340671,-0.019347355,-0.012294722,-0.015464812,-0.02787065,0.0100462455,0.0023432523,0.021765776,0.017935522,-0.00071612996,0.021726558,-0.007294476,-0.024733242,-0.01683743,-0.00049757346,-0.002848179,-0.007470955,-0.0015687045,0.006095071,-0.005794402,-0.040472575,-0.014340574,0.006268282,-0.0068892273,0.0043433504,0.009987419,0.029177904,0.010935178,-0.0009207969,0.029125614,-0.021608904,-0.021099076,0.03281207,-0.0035459257,-0.01643218,0.001898786,-0.013412423]
   #  fnc=[
   #      {
   #          "$vectorSearch": {
   #              "index": "vector_index",
   #              "path": "embedding",
   #              "queryVector":embeds,
   #              "numCandidates": 2,
   #              "limit": 2,
   #              "filter":    {"metadata": {"$elemMatch": {
   #    "key": "portfolio_name",
   #    "value": "Managed Funds Portfolio"
   #   }
   #  }
   # }
   #  }
   #  }
   #  ]
   #  outDocs = data.aggregate(fnc)
   #
   #  if outDocs is not None:
   #      print("Output is not null proceed to LLM")
   #  else:
   #      print("no Output Exists")
   #
   #  for i in outDocs:
   #      print(i['chunk_id'])
   #      print(i['knowledge_base_id'])
except Exception as e:
    print(e)

import datetime

def get_index_status(self, mongodb_name, collection_name):
    status_details = []
    cursor = self.mongo_client[mongodb_name][collection_name].list_search_indexes()
    # logger.info(f"Fetching index from db from {collection_name}")
    for index in cursor:
        if index.get("statusDetail", []):
            status_details = index.get("statusDetail", [])
    return status_details
#"""wait for index ready status upto 180 secs"""

def wait_for_index_ready(self, mongodb_name, collection_name, timeout=180):
 # logger.debug("Waiting for index ready status")
 end_time = datetime.now() + timedelta(seconds=timeout)
 while datetime.now() < end_time:
     status_detail = self.get_index_status(mongodb_name, collection_name)
     if self.can_proceed_with_queries(status_detail):
         return True
    time.sleep(5) # Wait for 5 seconds before the next check
 return False
